!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","lodash","angular","swiper","stratus.services.registry","stratus.services.model","stratus.services.collection","stratus.directives.src"],factory):factory(root.Stratus,root._,root.angular,root.Swiper)}(this,function(Stratus,_,angular,Swiper){const min=Stratus.Environment.get("production")?".min":"",name="carousel";Stratus.Components.Carousel={transclude:{slide:"?stratusCarouselSlide"},bindings:{elementId:"@",ngModel:"=",property:"@",target:"@",id:"@",manifest:"@",decouple:"@",direct:"@",api:"@",urlRoot:"@",limit:"@",options:"<",initNow:"=",images:"<",slides:"<",imageLinkTarget:"@",direction:"@",transitionEffect:"@",roundLengths:"@",loop:"@",autoHeight:"@",autoplay:"@",autoplayDelay:"@",lazyLoad:"@",navigation:"@",pagination:"@",scrollbar:"@",slidesPerGroup:"@",stretchWidth:"@",allowTouchMove:"@",allowZoom:"@"},controller:["$scope","$attrs","$window","$element","Registry","Model","Collection",function($scope,$attrs,$window,$element,Registry,Model,Collection){const $ctrl=this;function init(){let images=$ctrl.images?$ctrl.images:[],slides=$ctrl.slides?$ctrl.slides:images;$scope.imageLinkTarget=$attrs.imageLinkTarget?$attrs.imageLinkTarget:null,$scope.direction=$attrs.direction&&"vertical"===$attrs.direction?"vertical":"horizontal",$scope.transitionEffect=$attrs.transitionEffect?$attrs.transitionEffect:"slide",$scope.roundLengths=!$attrs.roundLengths||!_.isJSON($attrs.roundLengths)||JSON.parse($attrs.roundLengths),$scope.loop=!$attrs.loop||!_.isJSON($attrs.loop)||JSON.parse($attrs.loop),$scope.gallery=!(!$attrs.gallery||!_.isJSON($attrs.gallery))&&JSON.parse($attrs.gallery),$scope.gallery&&($scope.loop=!1),$scope.scaleHeight=!$attrs.scaleHeight||!_.isJSON($attrs.scaleHeight)||JSON.parse($attrs.scaleHeight),$scope.allowZoom=!(!$attrs.allowZoom||!_.isJSON($attrs.allowZoom))&&JSON.parse($attrs.allowZoom),$scope.scaleHeight=$scope.scaleHeight||$scope.allowZoom,$scope.stretchWidth=!(!$attrs.stretchWidth||!_.isJSON($attrs.stretchWidth))&&JSON.parse($attrs.stretchWidth),$scope.autoHeight=!(!$attrs.autoHeight||!_.isJSON($attrs.autoHeight))&&JSON.parse($attrs.autoHeight),$scope.autoplay=!(!$attrs.autoplay||!_.isJSON($attrs.autoplay))&&JSON.parse($attrs.autoplay),$scope.allowTouchMove=!$attrs.allowTouchMove||!_.isJSON($attrs.allowTouchMove)||JSON.parse($attrs.allowTouchMove),$scope.transitionDelay=$attrs.transitionDelay&&_.isJSON($attrs.transitionDelay)?JSON.parse($attrs.transitionDelay):3e3,$scope.lazyLoad=$attrs.lazyLoad&&_.isJSON($attrs.lazyLoad)?JSON.parse($attrs.lazyLoad):{},$scope.navigation=!$attrs.navigation||!_.isJSON($attrs.navigation)||JSON.parse($attrs.navigation),$scope.pagination=!(!$attrs.pagination||!_.isJSON($attrs.pagination))&&JSON.parse($attrs.pagination),$scope.scrollbar=!(!$attrs.scrollbar||!_.isJSON($attrs.scrollbar))&&JSON.parse($attrs.scrollbar),$scope.slidesPerGroup=!(!$attrs.slidesPerGroup||!_.isJSON($attrs.slidesPerGroup))&&JSON.parse($attrs.slidesPerGroup),function(images){"string"==typeof images&&(images=[images]);if(_.isArray(images)){let processedImages=[];images.forEach(function(image){let preppedImage={};"string"==typeof image?preppedImage.src=image:"object"==typeof image&&image.hasOwnProperty("src")&&(preppedImage=image),Object.keys(preppedImage).length>0&&processedImages.push(preppedImage)}),processedImages.length>0&&($scope.images=processedImages,$scope.images.length<2&&($scope.loop=!1,$scope.allowTouchMove=!1))}}(slides),$scope.initSwiper(),$scope.initialized=!0}$ctrl.uid=_.uniqueId(_.camelToSnake(name)+"_"),Stratus.Instances[$ctrl.uid]=$scope,$scope.elementId=$attrs.elementId||$ctrl.uid,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"extras/components/"+name+min+".css"),$scope.initialized=!1,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"node_modules/swiper/dist/css/swiper"+min+".css"),$scope.property=$attrs.property||null,$scope.data=null,$scope.model=null,$scope.collection=null,$attrs.target&&($scope.registry=new Registry,$scope.registry.fetch($attrs,$scope)),$scope.$watch("$ctrl.ngModel",function(data){data instanceof Model&&data!==$scope.model?$scope.model=data:data instanceof Collection&&data!==$scope.collection&&($scope.collection=data)}),$scope.$watch("collection.models",function(models){$scope.images=$scope.images||[],(models=models||[]).forEach(function(model){$scope.images.push("model:",model.data)})}),$ctrl.$onInit=function(){let initNow=!0;$attrs.$attr.hasOwnProperty("initNow")&&(initNow=!!_.isJSON($attrs.initNow)&&JSON.parse($attrs.initNow)),initNow?init():$ctrl.stopWatchingInitNow=$scope.$watch("$ctrl.initNow",function(initNow){!0===initNow&&($scope.initialized||init(),$ctrl.stopWatchingInitNow())})},$scope.imageClick=function(slideImage){slideImage&&slideImage.hasOwnProperty("link")&&$window.open(slideImage.link,$scope.imageLinkTarget||slideImage.target||"_self")},$scope.initSwiper=function(){if($ctrl.swiperContainer=$element[0].querySelector(".swiper-container"),$ctrl.swiperParameters={direction:$scope.direction,zoom:$scope.allowZoom,loop:$scope.loop,effect:$scope.transitionEffect,autoHeight:$scope.autoHeight,allowTouchMove:$scope.allowTouchMove},$scope.navigation&&($ctrl.swiperNextEl=$ctrl.swiperContainer.getElementsByClassName("swiper-button-next")[0],$ctrl.swiperPrevEl=$ctrl.swiperContainer.getElementsByClassName("swiper-button-prev")[0],$ctrl.swiperParameters.navigation={nextEl:$ctrl.swiperNextEl,prevEl:$ctrl.swiperPrevEl}),$scope.pagination){if($ctrl.swiperParameters.pagination={},"object"==typeof $scope.pagination&&($scope.pagination.hasOwnProperty("el")&&($ctrl.swiperPaginationEl=$ctrl.swiperContainer.getElementsByClassName($scope.pagination.el)[0]),$scope.pagination.hasOwnProperty("clickable")&&($ctrl.swiperParameters.pagination.clickable=$scope.pagination.clickable),$scope.pagination.hasOwnProperty("dynamicBullets")&&($ctrl.swiperParameters.pagination.dynamicBullets=$scope.pagination.dynamicBullets),$scope.pagination.hasOwnProperty("dynamicMainBullets")&&($ctrl.swiperParameters.pagination.dynamicMainBullets=$scope.pagination.dynamicMainBullets),$scope.pagination.hasOwnProperty("render")))switch($scope.pagination.render){case"fraction":$ctrl.swiperParameters.pagination.type="fraction";break;case"customFraction":$ctrl.swiperParameters.pagination.type="fraction",$ctrl.swiperParameters.pagination.renderFraction=function(currentClass,totalClass){return'<span class="'+currentClass+'"></span> of <span class="'+totalClass+'"></span>'};break;case"progressbarOpposite":$ctrl.swiperParameters.pagination.progressbarOpposite=!0,$ctrl.swiperParameters.pagination.type="progressbar";break;case"progressbar":$ctrl.swiperParameters.pagination.type="progressbar";break;case"numberBullet":$ctrl.swiperParameters.pagination.renderBullet=function(index,className){return'<span class="'+className+' swiper-pagination-number-bullet">'+(index+1)+"</span>"};break;case"bullet":default:$ctrl.swiperParameters.pagination.type="bullet"}$ctrl.swiperPaginationEl||($ctrl.swiperPaginationEl=$ctrl.swiperContainer.getElementsByClassName("swiper-pagination")[0]),$ctrl.swiperParameters.pagination.el=$ctrl.swiperPaginationEl}$scope.scrollbar&&($ctrl.swiperScrollbarEl=$ctrl.swiperContainer.getElementsByClassName("swiper-scrollbar")[0],$ctrl.swiperParameters.scrollbar={el:$ctrl.swiperScrollbarEl}),$scope.slidesPerGroup&&($ctrl.swiperParameters.slidesPerView=$scope.slidesPerGroup),$scope.autoplay&&(!0===$scope.autoplay&&($scope.autoplay={delay:$scope.transitionDelay,disableOnInteraction:!1}),!$scope.loop&&$scope.autoplay&&("boolean"==typeof $scope.autoplay&&($scope.autoplay={}),$scope.autoplay.hasOwnProperty("stopOnLastSlide")||($scope.autoplay.stopOnLastSlide=!0)),$ctrl.swiperParameters.autoplay=$scope.autoplay),$scope.lazyLoad&&(!0===$scope.lazyLoad&&($scope.lazyLoad={}),$scope.lazyLoad&&!$scope.lazyLoad.hasOwnProperty("loadPrevNext")&&($scope.lazyLoad.loadPrevNext=!0),$scope.lazyLoad&&!$scope.lazyLoad.hasOwnProperty("loadPrevNextAmount")&&($scope.lazyLoad.loadPrevNextAmount=1),$scope.lazyLoad&&!$scope.lazyLoad.hasOwnProperty("loadOnTransitionStart")&&($scope.lazyLoad.loadOnTransitionStart=!0),$ctrl.swiperParameters.lazy=$scope.lazyLoad,$ctrl.swiperParameters.preloadImages=!1),$scope.$applyAsync(function(){$ctrl.swiper=new Swiper($ctrl.swiperContainer,$ctrl.swiperParameters),$scope.gallery&&($ctrl.galleryContainer=$element[0].getElementsByClassName("swiper-gallery")[0].getElementsByClassName("swiper-container")[0],$ctrl.gallerySwiper=new Swiper($ctrl.galleryContainer,{direction:"horizontal",effect:"slide",preloadImages:!1,spaceBetween:10,centeredSlides:!0,slidesPerView:8,touchRatio:.2,slideToClickedSlide:!0}),$ctrl.swiper.controller.control=$ctrl.gallerySwiper,$ctrl.gallerySwiper.controller.control=$ctrl.swiper)})}}],templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"extras/components/"+name+min+".html"}});