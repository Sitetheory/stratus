!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","lodash","jquery","angular"],factory):factory(root.Stratus,root._,root.jQuery,root.angular)}(this,function(Stratus,_,jQuery,angular){Stratus.Directives.OnScreen=function(){return{restrict:"A",scope:{onScreen:"@onScreen",stratusOnScreen:"@stratusOnScreen",offScreen:"@offScreen",spy:"@spy",target:"@target",partial:"@partial",update:"@update",animation:"@animation",event:"@event",offset:"@offset",reset:"@reset"},link:function($scope,element,attrs){this.uid=_.uniqueId(_.camelToSnake("onScreen")+"_"),Stratus.Instances[this.uid]=$scope;let $element=element instanceof jQuery?element:jQuery(element);$scope.elementId=$element.elementId||this.uid,$scope.initialized=!1,element.uid=this.uid,Stratus.Instances[element.uid]=$scope,$scope.elementId=attrs.elementId||element.uid;let event=attrs.event?attrs.event.split(" "):[],target=attrs.target?jQuery(attrs.target):$element,spy=attrs.spy?jQuery(attrs.spy):$element;spy.length||(spy=$element);let partial=_.hydrate(attrs.partial);"boolean"!=typeof partial&&(partial=!0);let update=_.hydrate(attrs.update);"number"!=typeof update&&(update=100);let animation=_.hydrate(attrs.animation);"number"!=typeof animation&&(animation=!1);let lastUpdate=0,isWaiting=!1,wasOnScreen=!1,wipeJob=null,offset=_.hydrate(attrs.offset)||0,reset=_.hydrate(attrs.reset)||0,wipe=function(request){animation&&(_.isUndefined(request)?(_.isNumber(wipeJob)&&clearTimeout(wipeJob),wipeJob=setTimeout(function(){wipe(!0)},animation)):target.removeClass("reveal conceal"))},calculate=function(){if(-1!==event.indexOf("reset")&&(reset>0&&$element.offset().top<=reset||jQuery(window).scrollTop()<=0))return target.removeClass("on-screen off-screen scroll-up scroll-down reveal conceal"),void target.addClass("reset");!function(){if(isWaiting)return wasOnScreen;let calculation=(new Date).getTime();return calculation-lastUpdate>update?(lastUpdate=calculation,wasOnScreen=Stratus.Internals.IsOnScreen(spy,offset,partial)):(isWaiting=!0,setTimeout(function(){isWaiting=!1,calculate()},lastUpdate+update-calculation+1)),wasOnScreen}()?(target.hasClass("on-screen")&&target.removeClass("on-screen"),target.hasClass("off-screen")||target.addClass("off-screen"),!attrs.offScreen||"function"!=typeof attrs.offScreen||attrs.offScreen()):(target.hasClass("on-screen")||target.addClass("on-screen on-screen-init"),target.hasClass("off-screen")&&target.removeClass("off-screen"),!attrs.onScreen||"function"!=typeof attrs.onScreen||attrs.onScreen())};Stratus.Internals.OnScroll(),Stratus.Environment.on("change:viewPortChange",calculate),Stratus.Environment.on("change:lastScroll",function(){let lastScroll=Stratus.Environment.get("lastScroll");"down"!==lastScroll||target.hasClass("reset")||(target.hasClass("scroll-down")||target.addClass("scroll-down"),target.hasClass("scroll-up")&&target.removeClass("scroll-up"),animation&&Stratus.Internals.IsOnScreen(spy,offset,partial)&&(target.hasClass("reveal")&&target.removeClass("reveal"),target.hasClass("conceal")||target.addClass("conceal"),wipe())),"up"===lastScroll&&(target.hasClass("scroll-up")||target.addClass("scroll-up"),target.hasClass("scroll-down")&&target.removeClass("scroll-down"),target.hasClass("reset")&&target.removeClass("reset"),animation&&(target.hasClass("reveal")||target.addClass("reveal"),target.hasClass("conceal")&&target.removeClass("conceal"),wipe()))})}}}});