<h1 mat-dialog-title>Link Selector</h1>

<div mat-dialog-content class="link-dialog-content">
    <form class="dialog-form" [formGroup]='dialogLinkForm'>
        <mat-form-field class="form-field">
            <input matInput placeholder="Search Content" aria-label="Search Content" formControlName='linkQueryInput'>
        </mat-form-field>
    </form>
    <mat-progress-bar mode="indeterminate" *ngIf="isContentLoading || !styled"></mat-progress-bar>
    <div class="content-list" *ngIf="styled">
        <!--[matTooltip]="isSelected(contentEntity) ? 'Selected' : 'Not Selected'"-->
        <div class="content-list-row content-box"
             [ngClass]="{'active': _.get(contentEntity, 'status') === 1, 'inactive' : _.get(contentEntity, 'status') !== 1, 'published': _.get(contentEntity, 'version.published') === 1, 'unpublished': _.get(contentEntity, 'version.published') !== 1, 'selected': isSelected(contentEntity)}"
             (click)="select(contentEntity)"
             *ngFor="let contentEntity of contentEntities">
            <div class="content-list-container">
                <div class="column-image position-anchor">
                    <!-- This adds stratus-src lazy loading if bestImage isn't a third party service without image sizes, e.g. Video -->
                    <div class="image position-all"
                         *ngIf="_.has(contentEntity, 'version.bestImage._thumbnailUrl')"
                         [attr.data-stratus-src]="!_.get(contentEntity, 'version.bestImage.service') ? true : false"
                         [ngStyle]="{'background': 'url(' + _.get(contentEntity, 'version.bestImage._thumbnailUrl') + ') no-repeat center center', 'background-size': 'cover'}">
                    </div>

                    <!-- Icon for items with no image -->
                    <div class="no-image-icon position-all"
                         *ngIf="!_.has(contentEntity, 'version.bestImage._thumbnailUrl')"
                         [ngClass]="_.get(contentEntity, 'contentType.class') + '-background-color'">

                        <mat-icon class="content-type-icon position-center"
                                  [svgIcon]="getSvg(Stratus.BaseUrl + (_.get(contentEntity, 'contentType.iconResourcePath') || _.get(contentEntity, 'iconResourcePath'))) | async">
                            Icon
                        </mat-icon>
                    </div>

                    <!-- Shapeholder -->
                    <img class="shapeholder" [src]="Stratus.BaseUrl + 'sitetheorycore/images/shapeholder-square.png'">

                </div>
                <div class="column-title">
                    <!-- _.has(contentEntity, 'iconResourcePath') || _.has(contentEntity, 'contentType.iconResourcePath') -->
                    <div class="content-type" *ngIf="_.has(contentEntity, 'contentType.iconResourcePath')">
                        <!--
                        I disabled the position-center class on this one as it causes the icon
                        to break away from the div and float to the top of the selector container
                        -->
                        <mat-icon class="content-type-icon"
                                  [svgIcon]="getSvg(Stratus.BaseUrl + _.get(contentEntity, 'contentType.iconResourcePath')) | async">
                            ContentType Icon
                        </mat-icon>
                        <span class="comment content-type-name font-body"
                              [ngClass]="((_.get(contentEntity, 'contentType.name') || _.get(contentEntity, 'name')) | lowercase) + '-color'"
                              [textContent]="(_.get(contentEntity, 'contentType.name') || _.get(contentEntity, 'name')) + ((_.get(contentEntity, 'status') !== 1) ? ' (hidden)' : '') + ((_.get(contentEntity, 'version.published') !== 1) ? ' (unpublished)' : '')">
                        </span>
                    </div>

                    <!-- This include fallbacks in case a version is not present -->
                    <h3 [innerHTML]="_.get(contentEntity, 'version.bestIdentifier') || _.get(contentEntity, 'name') || (_.get(contentEntity, 'contentType.controller') === 'Content\\Module' ? _.get(contentEntity, 'version.internalIdentifier') : 'Untitled ' + _.get(contentEntity, 'contentType.name') + ' (' + _.get(contentEntity, 'id') + ')')"></h3>
                    <!-- TODO: make this clickable in new window -->
                    <span class="routing"
                          [textContent]="(_.has(contentEntity, 'routing') ? '/' + _.get(contentEntity, 'routing[0].url') : null) || _.get(contentEntity, 'description') || ''">
                    </span>
                </div>
                <div class="column-action">
                    <a mat-button
                       *ngIf="_.has(contentEntity, 'contentType.editUrl')"
                       [matTooltip]="'Edit ' + (_.get(contentEntity, 'contentType.name') || _.get(contentEntity, 'name'))"
                       aria-label="Edit Item in New Window"
                       class="btn btn-edit"
                       (click)="goToUrl(contentEntity, '_blank');">
                        <mat-icon svgIcon="selector_edit" aria-hidden="false" aria-label="Edit Item">Edit</mat-icon>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
