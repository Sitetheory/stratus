(function(root,factory){if(typeof define==="function"&&define.amd){define(["stratus","underscore","angular","angular-material","stratus.services.model"],factory)}else{factory(root.Stratus,root._)}})(this,function(Stratus,_){Stratus.Components.Edit={transclude:{view:"?stratusEditView",input:"?stratusEditInput"},bindings:{elementId:"@",ngModel:"=",property:"@",autoSave:"@"},controller:function($scope,$element,$attrs,$timeout,model){this.uid=_.uniqueId("edit_");Stratus.Instances[this.uid]=$scope;$scope.elementId=$attrs.elementId||this.uid;$scope.edit_input_container=$element[0].getElementsByClassName("stratus_edit_input_container")[0];$scope.edit=false;$scope.property=$attrs.property||null;$scope.autoSave=$attrs.autoSave||null;$scope.model=null;$scope.value=null;if(!model||!$scope.property){console.warn($scope.uid+" has no model or property!");return}$scope.setEdit=function(bool){if(Stratus.Environment.data.liveEdit&&bool){$scope.edit=bool;$scope.focusOnEditable()}else{$scope.edit=false}};$scope.focusOnEditable=function(){$timeout(function(){if($scope.edit_input_container.getElementsByTagName("input").length>0){$scope.edit_input_container.getElementsByTagName("input")[0].focus()}else if($($scope.edit_input_container).find("[contenteditable]").length>0){$($scope.edit_input_container).find("[contenteditable]").focus()}else{$scope.edit_input_container.focus()}},0)};$scope.accept=function(){if($scope.model instanceof model&&$scope.property){$scope.model.set($scope.property,$scope.value);$scope.model.save()}};$scope.cancel=function(){if($scope.model instanceof model&&$scope.property){$scope.value=$scope.model.get($scope.property)}$scope.setEdit(false)};$scope.$watch("$ctrl.ngModel",function(data){if(data instanceof model&&!_.isEqual(data,$scope.model)){$scope.model=data}});$scope.$watch("model.data."+$scope.property,function(data){$scope.value=data});$($scope.edit_input_container).on("keypress",function(event){console.log(event);switch(event.which){case Stratus.Key.Enter:if($scope.autoSave!==false&&$scope.autoSave!=="false"){$scope.$apply($scope.accept)}$scope.setEdit(false);break;case Stratus.Key.Escape:$scope.$apply($scope.cancel);break}});$($scope.edit_input_container).on("focusout",function(){if($scope.autoSave!==false&&$scope.autoSave!=="false"){$scope.$apply($scope.accept)}$scope.setEdit(false)})},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/edit"+(Stratus.Environment.get("production")?".min":"")+".html"}});