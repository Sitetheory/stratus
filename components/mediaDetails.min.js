!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","angular","angular-material","stratus.services.media"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Components.MediaDetails={bindings:{ngModel:"=",media:"<",collection:"<"},controller:["$scope","$mdDialog","$attrs","commonMethods","media","$sce",function($scope,$mdDialog,$attrs,commonMethods,media,$sce){commonMethods.componentInitializer(this,$scope,$attrs,"media_details",!0);var $ctrl=this;$ctrl.$onInit=function(){initFile($ctrl.media),$ctrl.tags=$ctrl.media.tags,$ctrl.infoId=$ctrl.media.id,$ctrl.deleteMedia=deleteMedia,$ctrl.getLinkMedia=getLinkMedia,$ctrl.closeDialog=closeDialog,$ctrl.openUploader=openUploader,$ctrl.createTag=createTag,$ctrl.editItem=editItem,$ctrl.doneEditing=doneEditing,$ctrl.searchFilter=searchFilter};function initFile(fileData){if(fileData.url?$ctrl.mediaUrl="http://"+fileData.prefix+"."+fileData.extension:$ctrl.mediaUrl=fileData.file,"video"===fileData.mime){if("youtube"===fileData.service)var videoUrl="https://www.youtube.com/embed/"+fileData.file.split("v=")[1].split("&")[0];else if("vimeo"===fileData.service)videoUrl="https://player.vimeo.com/video/"+fileData.file.split(/video\/|https?:\/\/vimeo\.com\//)[1].split(/[?&]/)[0];$ctrl.mediaUrl=$sce.trustAsResourceUrl(videoUrl)}$ctrl.selectedName={name:fileData.name,editing:!1},$ctrl.selectedDesc={description:fileData.description,editing:!1}}function deleteMedia(){var fileId=$ctrl.media.id;Stratus.Environment.get("production")||console.log(fileId),$mdDialog.show($mdDialog.confirm().title("DELETE MEDIA").textContent("Are you sure you want to permanently delete this from your library? You may get broken images if any content still uses this image.").multiple(!0).ok("Yes").cancel("No")).then(function(){media.deleteMedia(fileId).then(function(response){commonMethods.getStatus(response).code==commonMethods.RESPONSE_CODE.success?($mdDialog.cancel(),media.getMedia($ctrl)):$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!1).title("Error").multiple(!0).textContent(commonMethods.getStatus(response).message).ok("Ok"))},function(rejection){Stratus.Environment.get("production")||console.log(rejection)})})}function getLinkMedia(){commonMethods.copyToClipboard($ctrl.mediaUrl)&&$mdDialog.show($mdDialog.confirm().textContent("Link is copied to clipboard").multiple(!0).ok("OK"))}function closeDialog(){$mdDialog.cancel()}function openUploader(ngfMultiple,fileId){$mdDialog.show({attachTo:angular.element(document.querySelector("#listContainer")),controller:function(scope,collection,ngfMultiple,fileId){scope.collection=collection,scope.ngfMultiple=ngfMultiple,scope.fileId=fileId},template:'<stratus-media-uploader collection="collection" ngf-multiple="ngfMultiple" file-id="fileId"></stratus-media-uploader>',clickOutsideToClose:!1,focusOnOpen:!0,autoWrap:!0,multiple:!0,locals:{collection:$ctrl.collection,ngfMultiple:ngfMultiple,fileId:fileId}}).then(function(response){console.log(response),fileId&&!_.isEmptyObject(response)&&(response[0].errorUpload||initFile(response[0].result))})}function createTag(query,fileId,tags){var data={name:query};media.createTag(data).then(function(response){if(commonMethods.getStatus(response).code==commonMethods.RESPONSE_CODE.success&&void 0!==fileId&&void 0!==tags){var dataRes={};$ctrl.tags.push(response.data.payload),dataRes.tags=$ctrl.tags,updateMedia(fileId,dataRes)}})}function updateMedia(fileId,data){media.updateMedia(fileId,data).then(function(response){commonMethods.getStatus(response).code==commonMethods.RESPONSE_CODE.success&&media.getMedia($ctrl)})}function editItem(item){item.editing=!0}function doneEditing(fileId,item){var data={};item.description&&(data.description=item.description),item.name&&(data.name=item.name),item.editing=!1,updateMedia(fileId,data)}function searchFilter(query){return $ctrl.collection.filter(query)}$scope.$watch("$ctrl.tags",function(data){if(void 0!==$ctrl.infoId){var dataRes={};dataRes.tags=$ctrl.tags,media.updateMedia($ctrl.infoId,dataRes).then(function(response){media.getMedia($ctrl)},function(rejection){Stratus.Environment.get("production")||console.log(rejection)})}},!0)}],templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/mediaDetails"+(Stratus.Environment.get("production")?".min":"")+".html"}});