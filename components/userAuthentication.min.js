!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","zxcvbn","stratus.components.singleSignOn","stratus.services.userAuthentication","stratus.services.commonMethods","stratus.directives.passwordCheck","stratus.directives.compileTemplate"],factory):factory(root.Stratus,root._,root.angular,root.zxcvbn)}(this,function(Stratus,_,angular,zxcvbn){Stratus.Components.UserAuthentication={bindings:{isLoggedIn:"<",email:"<"},controller:function($scope,$window,$attrs,$compile,userAuthentication,commonMethods){commonMethods.componentInitializer(this,$scope,$attrs,"user_authentication",!0);var $ctrl=this;function verifyAccount(){resetDefaultSetting(),$ctrl.loading=!0;var data={type:"verify",email:commonMethods.getUrlParams().email,token:commonMethods.getUrlParams().token};userAuthentication.verifyAccount(data).then(function(response){$ctrl.loading=!1,commonMethods.getStatus(response).code===commonMethods.RESPONSE_CODE.verify?($ctrl.message=commonMethods.getStatus(response).message,$ctrl.isRequestSuccess=!0,$ctrl.enabledVerifyForm=!1,$ctrl.enabledResetPassForm=!0,$ctrl.resetPassHeaderText="Please set your password",$ctrl.changePassBtnText="Update password"):($ctrl.isRequestSuccess=!1,$ctrl.enabledVerifyForm=!1,$ctrl.message=commonMethods.getStatus(response).message)})}function doSignIn(signinData){$ctrl.loading=!0,resetDefaultSetting();var data={email:signinData.email,password:signinData.password};userAuthentication.signIn(data).then(function(response){if($ctrl.loading=!1,commonMethods.getStatus(response).code===commonMethods.RESPONSE_CODE.success)return $window.location.href="/";$ctrl.isRequestSuccess=!1,$ctrl.message=commonMethods.getStatus(response).message})}function doSignUp(signupData){if($ctrl.loading=!0,$ctrl.socialMode)return email=signupData.email,$ctrl.loading=!1,void $scope.$broadcast("doSocialSignup",email);var email;resetDefaultSetting();var data={email:signupData.email,phone:commonMethods.cleanedPhoneNumber(signupData.phone)};userAuthentication.signUp(data).then(function(response){if($ctrl.loading=!1,commonMethods.getStatus(response).code===commonMethods.RESPONSE_CODE.success)return $window.location.href="/";$ctrl.isRequestSuccess=!1;var status=commonMethods.getStatus(response);$ctrl.message="DUPLICATE"===status.code?$ctrl.duplicateMessge:status.message})}function doRequestResetPass(resetPassData){$ctrl.loading=!0,resetDefaultSetting();var data={type:"reset-password-request",email:resetPassData.email,phone:commonMethods.cleanedPhoneNumber(resetPassData.phone)};userAuthentication.requestResetPass(data).then(function(response){$ctrl.loading=!1,commonMethods.getStatus(response).code===commonMethods.RESPONSE_CODE.success?$ctrl.isRequestSuccess=!0:$ctrl.isRequestSuccess=!1,$ctrl.message=commonMethods.getStatus(response).message})}function doResetPass(resetPassData){$ctrl.loading=!0,resetDefaultSetting();var data={type:"verify"===commonMethods.getUrlParams().type?"change-password":commonMethods.getUrlParams().type,email:commonMethods.getUrlParams().email,token:commonMethods.getUrlParams().token,password:resetPassData.password};$ctrl.passwordReset&&(data.email=$ctrl.email,data.type="update-password",data.confirm_password=resetPassData.confirm_password),userAuthentication.resetPass(data).then(function(response){$ctrl.loading=!1,commonMethods.getStatus(response).code===commonMethods.RESPONSE_CODE.success?$window.location.href=$window.location.origin+"/Member/Sign-In":($ctrl.isRequestSuccess=!1,$ctrl.message=commonMethods.getStatus(response).message)})}function showForgotPassForm(isShow){$ctrl.message=null,$ctrl.forgotPassText=isShow?"Back to login":"Forgot Password?",($ctrl.enabledForgotPassForm=isShow)||onTabSelected($ctrl.signInIndex)}function backToLogin(){$ctrl.message=null,$ctrl.isHandlingUrl=!1}function onTabSelected(index){$ctrl.selectedIndex=index,$ctrl.message=null}function resetDefaultSetting(){$ctrl.socialMode=!1,$ctrl.message=null}function safeMessage(){return commonMethods.safeMessage($ctrl.message)}$ctrl.$onInit=function(){$ctrl.signinData={},$ctrl.resetPassData={},$ctrl.allowSubmit=!1,$ctrl.socialMode=!1,$ctrl.loading=!1,$ctrl.signInIndex=0,$ctrl.signUpIndex=1,$ctrl.emailRegex=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/i,$ctrl.phoneRegex=/^[\d+\-().]+$/,$ctrl.enabledForgotPassForm=!1,$ctrl.isHandlingUrl=null!==commonMethods.getUrlParams().type,$ctrl.passwordReset=!!$ctrl.isLoggedIn&&!$ctrl.isHandlingUrl,$ctrl.enabledResetPassForm="reset-password"===commonMethods.getUrlParams().type,$ctrl.enabledVerifyForm="verify"===commonMethods.getUrlParams().type,$ctrl.forgotPassText="Forgot Password?",$ctrl.resetPassHeaderText="Reset your account password",$ctrl.changePassBtnText="Reset Password",$ctrl.selectedIndex=$ctrl.signInIndex,$ctrl.message=null,$ctrl.isRequestSuccess=!1,$ctrl.passwordReset?$ctrl.resetPassHeaderEmail=$ctrl.email:"reset-password"===commonMethods.getUrlParams().type?$ctrl.resetPassHeaderEmail=commonMethods.getUrlParams().email:$ctrl.resetPassHeaderEmail=null,$ctrl.duplicateMessge='<span>There is already an account registered to this email, please <a href="#" ng-click="$ctrl.onTabSelected($ctrl.signInIndex)">Sign In</a> and then create a new site from the control panel.</span>',$ctrl.showForgotPassForm=showForgotPassForm,$ctrl.doSignIn=doSignIn,$ctrl.doSignUp=doSignUp,$ctrl.doRequestResetPass=doRequestResetPass,$ctrl.doResetPass=doResetPass,$ctrl.onTabSelected=onTabSelected,$ctrl.backToLogin=backToLogin,$ctrl.verifyAccount=verifyAccount,$ctrl.safeMessage=safeMessage},$scope.$watch(angular.bind(this,function(){return _.isEmpty(this.signinData)?_.isEmpty(this.resetPassData)?void 0:($ctrl.isRequestSuccess=!1,this.resetPassData.password):this.signinData.password}),function(newValue,oldValue){void 0!==newValue&&newValue!==oldValue&&($ctrl.progressBarClass=commonMethods.generateProgressBar(newValue).progressBarClass,$ctrl.progressBarValue=commonMethods.generateProgressBar(newValue).progressBarValue,commonMethods.validPassword(newValue)?($ctrl.message=null,$ctrl.allowSubmit=!0,void 0!==$ctrl.resetPassData.confirm_password&&$ctrl.resetPassData.confirm_password!==newValue&&($ctrl.message="Your passwords did not match.",$ctrl.allowSubmit=!1)):($ctrl.message="Your password must be at 8 or more characters and contain at least one lower and uppercase letter and one number.",$ctrl.allowSubmit=!1))}),$scope.requireEmail=function(socialName,data){onTabSelected($ctrl.signUpIndex),$ctrl.socialMode=!0,$ctrl.isRequestSucces=!1,setTimeout(function(){$ctrl.message=data.message,$scope.$apply()},100)}},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".html"}});