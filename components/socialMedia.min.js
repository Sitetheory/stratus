!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.registry","stratus.services.model","stratus.services.collection","angular-material","stratus.services.socialLibraries"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){const min=Stratus.Environment.get("production")?".min":"";Stratus.Components.SocialMedia={bindings:{ngModel:"="},controller:function($rootScope,$scope,$window,$attrs,$log,$http,$mdDialog,socialLibraries,Model){const $ctrl=this;function FbGetBasicProfile(){FB.api("/me?fields=name,email,gender,locale,link,picture",function(response){doSignIn(response,"facebook",!0)},{scope:["email","name","gender","locale","phone","picture"]})}function doSignIn(data,service,truthData){if($scope.model)!function(data,service){data.hasOwnProperty("id")&&("google"===service?($scope.model.set("googleId",data.id),$scope.model.save()):($scope.model.set("facebookId",data.id),$scope.model.save()));$ctrl.ngModel.hasOwnProperty("profile")&&($ctrl.ngModel.profile.hasOwnProperty("publicName")&&($ctrl.ngModel.profile.publicName=data.name),$ctrl.ngModel.profile.hasOwnProperty("gender")&&data.hasOwnProperty("gender")&&($ctrl.ngModel.profile.gender="male"===data.gender?2:1),$ctrl.ngModel.profile.hasOwnProperty("locale")&&data.hasOwnProperty("locale")&&($ctrl.ngModel.profile.locale=data.locale),$ctrl.ngModel.profile.hasOwnProperty("phones")&&data.hasOwnProperty("phone")&&($ctrl.ngModel.profile.phones||($ctrl.ngModel.profile.phones=[]),$ctrl.ngModel.profile.phones.push(data.phone)),$ctrl.ngModel.profile.hasOwnProperty("emails")&&data.hasOwnProperty("email")&&($ctrl.ngModel.profile.emails||($ctrl.ngModel.profile.emails=[]),$ctrl.ngModel.profile.emails.push(data.email)));$scope.$digest()}(data,service);else{new Model({target:"Login"},{service:service,data:data,truthData:truthData}).save().then(function(data){console.log("response:",data)}).catch(function(error){console.error(error)})}}$ctrl.uid=_.uniqueId(_.camelToSnake("socialMedia")+"_"),Stratus.Instances[$ctrl.uid]=$scope,$scope.elementId=$attrs.elementId||$ctrl.uid,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"components/socialMedia"+min+".css"),$scope.initialized=!1,$scope.model=null,$scope.$watch("$ctrl.ngModel",function(data){if(data!==$scope.model){$scope.model=data,angular.element(document.querySelector(".social")).css("margin-bottom","1em")}}),socialLibraries.loadFacebookSDK(),socialLibraries.loadGGLibrary(),$scope.layout="column",$scope.removeFacebook=function(){$scope.model.get("facebookId")&&$mdDialog.show($mdDialog.confirm().title("CONFIRM DISCONNECTION").textContent("Are you sure you want to disconnect your account with google?").ok("Yes").cancel("No")).then(function(){$scope.model.set("facebookId",null),$scope.model.save()})},$scope.removeGoogle=function(){$scope.model.get("googleId")&&$mdDialog.show($mdDialog.confirm().title("CONFIRM DISCONNECTION").textContent("Are you sure you want to disconnect your account with google?").ok("Yes").cancel("No")).then(function(){$scope.model.set("googleId",null),$scope.model.save()})},window.checkLoginState=function(){FB.getLoginStatus(function(response){switch(response.status){case"connected":case"not_authorized":FbGetBasicProfile();break;default:FB.login(function(response){null!==response.authResponse?FbGetBasicProfile():FB.login()},{scope:["email","name","gender","locale","phone","picture"]})}})},window.onSignIn=function(googleUser){let profile=googleUser.getBasicProfile();doSignIn({email:profile.getEmail(),name:profile.getName(),id:profile.getId(),picture:profile.getImageUrl()},"google",!0)}},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/singleSignOn"+(Stratus.Environment.get("production")?".min":"")+".html"}});